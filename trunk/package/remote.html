<!DOCTYPE html>
<html>
<head>
<title>SmartHost</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="content-type" content="text/html; charset=GB2312" />
<meta name="author" content="mooringniu" />
<meta name="url" content="http://code.google.com/p/smarthost" />
<meta name="description" content="SmartHost A Remote IP/Host Remap Plugin for Fiddler" />
<style type="text/css" media="screen">
body{margin:0;padding:0;font-size:1.2em;line-height:1em;font-weight:600;max-width:device-width;min-width:320px;}
form{text-align: left;margin:0; padding:0; }
form input,form select,form button{ width:100%; line-height:1.2em;font-size:1.2em;}
form .input{ width: 80% !important; }
</style>
</head>
<body>
<form method="POST" action="/" onsubmit="return saveData()">
<fieldset>
    <legend>SmartHost</legend>
    <br/>
    <input type="hidden" id="remoteProxy" name="remoteProxy" />
    Proxy Mode:<br/>
    <select id="typeSelect" onchange="updateContent(this)">
        <option value="remote">Romote Proxy</option>
        <option value="local">No Romote</option>
    </select>
    <div id="remoteContent">
        <input type="text" id="remoteHost" placeholder="Remote IP 10.28.1.1" maxlength="15"/>
        <br/>
        <input type="tel" id="remotePort" placeholder="Port 8888" maxlength="5" value="8888"/>
    </div>
    <br/> <br/>
    <input type="submit" value="Submit">
    <p style="font-weight:normal">
        Romote Proxy:<br/>&nbsp;&nbsp;All HTTP request will be send to IP:Port Which you submitting here. Previous Host/IP setting won't be used.
        <br/><br/>
        No Remote:<br/>&nbsp;&nbsp;Current Proxy Remap the Host/IP which you submitting here.
    </p>
</fieldset>
</form>
<script type="text/javascript">
var sLocal = 'localStorage' in window,
    slct = document.getElementById('typeSelect'),
    tips = document.getElementById('remoteContent'),
    remote = document.getElementById('remoteProxy'),
    ip = document.getElementById('remoteHost'),
    port = document.getElementById('remotePort');
function updateContent(obj){
    if(obj.value=='remote'){
        tips.style.display = '';
    }else{
        tips.style.display = 'none';
        remote.value = '';
    }
}
function saveData(){
    var mode = slct.value;
    if(mode == 'remote'){
        if(ip.value.length<7 || !/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(ip.value)){
            alert("Invalid IP Address");
            return false;
        }
        if(port.value.length == 0 || !/^\d{2,5}$/.test(port.value)){
            alert("Invalid Port");
            return false;
        }
        remote.value = ip.value+':'+port.value;
        if(sLocal){
            localStorage.setItem('remoteProxy',remote.value);
        }else{
            var dt = new Date();
            dt.setTime(dt.getTime()+24*3600*1000*31);
            document.cookie = 'remoteProxy='+encodeURIComponent(remote.value)+'; expires='+dt.toGMTString()+'; path=/'; 
        }

    }
    if(sLocal){
        localStorage.setItem('mode',mode);
    }else{
        var dt = new Date();
        dt.setTime(dt.getTime()+24*3600*1000*31);
        document.cookie = 'mode='+mode+'; expires='+dt.toGMTString()+'; path=/'; 
    }
    return false;
}
if(sLocal){
    var proxy = localStorage.getItem('remoteProxy'),
        mode = localStorage.getItem('mode');
    if(!proxy){
        var cookies = document.cookie.split('; ');
        for(var i=0,il=cookies.length;i<il;i++){
            if(cookies[i].indexOf('remoteProxy=')==0){
                proxy = decodeURIComponent(cookies[i]).split('=')[1];
                break;
            }
        }
    }
    if(proxy){
        remote.value = proxy;
        proxy = proxy.split(':');
        ip.value = proxy[0],
        port.value = proxy[1];
    }
    if(mode){
        slct.value = mode;
        updateContent(slct);
    }
}
</script>
</body>
</html>
